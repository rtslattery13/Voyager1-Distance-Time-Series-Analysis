# RYAN SLATTERY
# MA641 - TIME SERIES ANALYSIS
# FINAL PROJECT
# SEASONAL TIME SERIES ANALYSIS OF VOYAGER 1 DISTANCE FROM EARTH

### DESCRIPTION: AS OF THE TIME I AM WRITING THIS PROJECT, VOYAGER 1 IS THE FARTHEST MAN-MADE SPACECRAFT FROM EARTH. THE SPACECRAFT EXITED THE SOLAR SYSTEM IN 2012 AND CONTINUES TO EXPLORE THE NEW FRONTIER OF INTERSTELLAR SPACE. HOWEVER, A PHENOMENON OBSERVED WITH VOYAGER 1 IS THAT WHILE THE SPACECRAFT TRAVELS AWAY FROM EARTH, THE DISTANCE BETWEEN EARTH AND VOYAGER 1 ACTUALLY DECREASES DURING SOME MONTHS... SO WHY? THIS IS BECAUSE THE EARTH TRAVELS AROUND THE SUN AT A FASTER RATE THAN VOYAGER 1 IS TRAVELLING AWAY FROM EARTH, CAUSING A STEEP INCREASE IN DISTANCE DURING SOME SEASONS AND A SLIGHT DECREASE IN DISTANCE DURING OTHERS. THIS MAKES THE VOYAGER 1 DISTANCE DATASET A PERFECT CANDIDATE FOR SEASONAL TIME SERIES MODELING AND FORECASTING.
```{r}
# LIBRARIES
library(tseries)
library(TSA)
library(forecast)
library(LSTS)
```

### 1. READING AND FORMATTING THE DATA
```{r}
# READING THE CSV
voyager1 = read.csv("/Users/ryanslattery/Desktop/Machine\ Learning\ Classes/MA641\ -\ Time\ Series\ Analysis/Project/Voyager1_Distance_Data.csv", header = FALSE)

# CONVERTING THE DATA TO A NUMERIC VECTOR
voyager1_data = na.omit(as.numeric(unlist(voyager1[2])))

# PLOTTING THE TIME SERIES
plot(voyager1_data, type = "o")

# WE WILL BE HOLDING OUT CERTAIN VALUES TO USE LATER FOR OUR FORECASTING. WE WILL ONLY BE OBSERVING 72 OF THE 96 VALUES
forecasting_data = voyager1_data
voyager1_data = voyager1_data[1:72]
```

### 2. DIFFERENCING TO MAKE THE TIME SERIES STATIONARY (USING A SEASONAL DIFFERENCE AND THEN A REGULAR DIFFERENCE)
```{r}
# PERFORMING THE SEASONAL DIFFERENCE FOR MONTHLY PERIODS
v1d_seasonal_diff = diff(voyager1_data, lag = 12)

# PLOTTING THE SEASONAL DIFFERENCED DATA
plot(v1d_seasonal_diff, type = "o")

# ADF TEST
adf.test(v1d_seasonal_diff)
```
**THIS TIME SERIES IS NOT STATIONARY SINCE THE AUGMENTED DICKEY-FULLER TEST PRODUCES A P-VALUE GREATER THAN 0.05. MORE DIFFERENCING IS REQUIRED TO MAKE THE SERIES STATIONARY**

```{r}
# REGULAR DIFFERENCING
v1d_diff = diff(v1d_seasonal_diff)

# PLOTTING THE TRANSFORMED TIME SERIES
plot(v1d_diff, type = "o")

# PERFORMING ANOTHER ADF TEST
adf.test(v1d_diff)
```
**NOW THAT THE P-VALUE IS LESS THAN 0.05, WE CAN OBSERVE THE ACF, PACF, AND EACF TO OBTAIN POTENTIAL ORDERS OF AR/MA MODELS.**

### 3. USING THE ACF, PACF, AND EACF TO OBTAIN AR/MA PARAMETERS
```{r}
# THE ACF; THIS WILL GIVE THE ORDERS OF MA PARAMETERS THROUGH LOOKING AT THE FIRST SET OF SIGNIFICANT LAGS
acf(v1d_diff, lag.max = 50)
```

**ACF SUGGESTS AN MA ORDER OF 1 (THE ONE SIGNIFICANT LAG AT K = 1) WITH A SEASONAL MA ORDER OF 1 (THE ONE SIGNIFICANT LAG AT K = 12, SINCE THIS IS A MONTHLY-SEASONAL TIME SERIES)**

```{r}
# THE PACF WILL GIVE THE NUMBER OF AR PARAMETERS THROUGH THE FIRST SIGNIFICANT LAGS.
pacf(v1d_diff, lag.max = 50)
```

**PACF SUGGESTS AN AR ORDER OF 2 (FROM THE TWO SIGNIFICANT LAGS AT THE BEGINNING) AND NO SEASONAL AR ORDERS**

```{r}
eacf(v1d_diff)
```

**EACF SUGGESTS THE BEST MODELS COULD BE AR(2), ARMA(2, 1), ARMA(1, 1), AND MA(1).**

### 4. MODEL SELECTION
```{r}
# SARIMA(2, 1, 1)x(0, 1, 1)[12]
v1d_arima1 <- Arima(voyager1_data, order = c(2, 1, 1), seasonal = list(order = c(0, 1, 1), period = 12), method = "ML")
print(v1d_arima1)

# SARIMA(1, 1, 1)x(0, 1, 1)[12]
v1d_arima2 <- Arima(voyager1_data, order = c(1, 1, 1), seasonal = list(order = c(0, 1, 1), period = 12), method = "ML")
print(v1d_arima2)

# SARIMA(0, 1, 1)x(0, 1, 1)[12]
v1d_arima3 <- Arima(voyager1_data, order = c(0, 1, 1), seasonal = list(order = c(0, 1, 1), period = 12), method = "ML")
print(v1d_arima3)

# SARIMA(1, 1, 0)x(0, 1, 1)[12]
v1d_arima4 <- Arima(voyager1_data, order = c(1, 1, 0), seasonal = list(order = c(0, 1, 1), period = 12), method = "ML")
print(v1d_arima4)
```

**WHEN LOOKING FOR THE BEST MODEL, IT IS GOOD TO PICK THE ONE WITH THE LARGEST LOG-LIKELIHOOD VALUE AND THE SMALLEST AIC/BIC VALUES. THE BEST MODEL IN THIS CASE IS THE SARIMA(2, 1, 1)x(0, 1, 1)[12] MODEL.**

### 5. RESIDUAL ANALYSIS
```{r}
# ACF OF SARIMA(2, 1, 1)x(0, 1, 1)[12] RESIDUALS
acf(v1d_arima1$residuals, lag.max = 50)

# LJUNG-BOX TEST TO OBSERVE IF RESIDUALS ARE INDEPENDENT
Box.Ljung.Test(v1d_arima1$residuals, lag = 50)
```

**THE LJUNG-BOX TEST PRODUCES P-VALUES GREATER THAN 0.05 FOR ALL GROUPS OF LAGS, MEANING ALL RESIDUALS ARE INDEPENDENT**

```{r}
# NORMALITY TESTS:
# Q-Q PLOT
qqnorm(v1d_arima1$residuals)
qqline(v1d_arima1$residuals)

# HISTOGRAM PLOT
hist(v1d_arima1$residuals)

# SHAPIRO TEST
shapiro.test(v1d_arima1$residuals)
```

**THE HISTOGRAM SEEMS TO RESEMBLE A SOMEWHAT NORMAL DISTRIBUTION, AS THE DATA SEEMS TO BE MOSTLY CENTERED AROUND 0 AND IS ROUGHLY SYMMETRIC. HOWEVER, THERE IS AN OUTLIER AT -0.4 WHICH CAN CAUSE PROBLEMS. AND WHILE THE Q-Q PLOT SEEMS TO BE MOSTLY LINEAR, THE OUTLIER APPEARS TO MAKE THE TAIL HEAVIER AS WELL.**

**THE SHAPIRO TEST REJECTS NORMALITY WITH A P-VALUE VERY CLOSE TO 0. WHILE IT IS RECOMMENDED TO HAVE NORMAL RESIDUALS FOR UNBIASED FORECASTS, THERE IS NOT MUCH I CAN DO TO MITIGATE THIS ISSUE AND MUST PROCEED WITH WHAT I HAVE.**

### 6. FORECASTING
```{r}
# STORING FORECASTED VALUES
forecasts <- forecast(v1d_arima1, h = 48)

# PLOTTING FORECASTS VS. ACTUAL DATA
plot(forecasts)
lines(forecasting_data)
```

**THE FORECASTS OBTAINED IN THE FIGURE ABOVE ARE ACCURATE! THE ACTUAL VALUES FIT IN THE CONFIDENCE INTERVALS OF THE FORECASTED VALUES, AND THE FORECASTS THEMSELVES LOOK LIKE AN EXACT CONTINUATION OF THE DATA!**

```{r}
# EVALUATING THE FORECASTS AND ACTUAL DATA WITH MSE
mse = sum((forecasts$mean[1:24] - forecasting_data[73:96])^2) / 24
print(paste0("MEAN SQUARED ERROR FOR SARIMA(2, 1, 1)x(0, 1, 1)12 FORECAST: ", mse))
```

**THE MSE VALUE OBTAINED IS SMALL, SUGGESTING THAT THE FORECASTED VALUES ARE A GOOD FIT!**